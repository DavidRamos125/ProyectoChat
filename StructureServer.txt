@startuml
title Diagrama de Clases - Servidor

class Servidor {
    - puerto : int
    - conexiones : ConcurrentHashMap<String, ClienteHandler>
    - logger : Logger
    + iniciar()
    + aceptarConexion()
    + registrarAccion(String)
}

class ClienteHandler {
    - socket : Socket
    - usuario : Usuario
    - in : InputStream
    - out : OutputStream
    - servidor : Servidor
    + run()
    + procesarMensaje(Mensaje)
    + procesarArchivo(Archivo)
}

class Usuario {
    - id : int
    - nombre : String
    - ip : String
    - estado : String
    - mensajesEnviados : int
    - mensajesRecibidos : int
}

class Mensaje {
    - id : int
    - remitente : Usuario
    - destinatario : Usuario
    - contenido : String
    - fecha : Date
}

class Archivo {
    - id : int
    - nombre : String
    - tamaÃ±o : long
    - propietario : Usuario
    - data : byte[]
}

class DAO {
    + guardarUsuario(Usuario)
    + actualizarEstadoUsuario(Usuario)
    + guardarMensaje(Mensaje)
    + guardarArchivo(Archivo)
    + obtenerUsuarios()
}

class Logger {
    + logAccion(String)
}

class ServidorController {
    - servidor : Servidor
    - dao : DAO
    - logger : Logger
    + iniciarServidor(puerto : int)
    + aceptarConexion()
    + procesarMensaje(mensaje : Mensaje)
    + procesarArchivo(archivo : Archivo)
    + actualizarEstadoUsuario(usuario : Usuario)
    + registrarAccion(accion : String)
}

Servidor "1" --> "*" ClienteHandler
Servidor "1" --> "1" Logger
ClienteHandler "1" --> "1" Usuario
ClienteHandler "1" --> "*" Mensaje
ClienteHandler "1" --> "*" Archivo
Servidor "1" --> "1" DAO
ServidorController "1" --> "1" Servidor
ServidorController "1" --> "1" Logger
ServidorController "1" --> "1" DAO
ServidorController "1" --> "*" Mensaje
ServidorController "1" --> "*" Archivo

@enduml


CREATE TABLE users (
    id                      INT AUTO_INCREMENT PRIMARY KEY,
    username                VARCHAR(50) NOT NULL UNIQUE
);


CREATE TABLE sessions (
    id                  VARCHAR(64) PRIMARY KEY,      -- Puede ser UUID
    user_id             INT NOT NULL,
    ip                  VARCHAR(45) NOT NULL,         -- IPv4/IPv6 compatible
    disconnection_time  DATETIME,
    status              ENUM('CONNECTED', 'DISCONNECTED') NOT NULL DEFAULT 'CONNECTED',
    FOREIGN KEY (user_id) REFERENCES users(id)
        ON DELETE CASCADE
);

CREATE TABLE files (
    id              INT AUTO_INCREMENT PRIMARY KEY,
    name            VARCHAR(255) NOT NULL,
    size            BIGINT NOT NULL,
    owner_id        INT NOT NULL,
    data            LONGBLOB NOT NULL,
    upload_date     DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (owner_id) REFERENCES users(id)
        ON DELETE CASCADE
);

CREATE TABLE messages (
    id                  INT AUTO_INCREMENT PRIMARY KEY,
    sender_id           INT NOT NULL,
    receiver_id         INT NOT NULL,
    content_type        ENUM('TEXT', 'FILE') NOT NULL,
    content_text        TEXT,                        -- Usado solo si content_type = TEXT
    content_file_id     INT,                         -- FK si content_type = FILE
    date_sent           DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (sender_id) REFERENCES users(id)
        ON DELETE CASCADE,
    FOREIGN KEY (receiver_id) REFERENCES users(id)
        ON DELETE CASCADE,
    FOREIGN KEY (content_file_id) REFERENCES files(id)
        ON DELETE SET NULL
);



